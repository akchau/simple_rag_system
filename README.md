# Simple RAG System v0.1.0

Простая система Retrieval-Augmented Generation (RAG) для работы с заметками в формате Markdown с использованием Mistral AI и FAISS для векторного поиска.

## Описание

Simple RAG System - это инструмент для создания интеллектуального помощника на основе ваших заметок. Система автоматически индексирует Markdown файлы, создает векторные представления текста и использует их для поиска релевантной информации при ответе на вопросы через Mistral AI.

## Основные возможности

- **Автоматическая обработка Markdown файлов** - система автоматически загружает и обрабатывает все `.md` файлы из указанной директории
- **Векторный поиск** - использует FAISS для быстрого поиска релевантных фрагментов текста
- **Интеграция с Mistral AI** - отвечает на вопросы на основе найденной информации
- **Кэширование индекса** - сохраняет построенный индекс для быстрого запуска
- **Гибкая настройка** - поддержка различных моделей Mistral AI
- **Умное управление промптами** - структурированное создание промптов с разделением найденной и дополнительной информации
- **Автоматическое создание заметок** - система автоматически создает новые заметки на основе ответов LLM
- **Структурированные ответы** - различение между информацией из заметок и дополнительной информацией от AI

## Установка

### Требования

- Python 3.8+
- Виртуальное окружение (рекомендуется)

### Шаги установки

1. **Клонируйте репозиторий:**
   ```bash
   git clone <repository-url>
   cd simple_rag_system
   ```

2. **Создайте виртуальное окружение:**
   ```bash
   python -m venv venv
   source venv/bin/activate  # Linux/Mac
   # или
   venv\Scripts\activate     # Windows
   ```

3. **Установите зависимости:**
   ```bash
   pip install -r req.txt
   ```

4. **Настройте переменные окружения:**
   ```bash
   cp example.env .env
   ```
   
   Отредактируйте файл `.env`:
   ```env
   API_TOKEN=your_mistral_api_token_here
   MODEL=mistral-large-latest
   NOTES_DIR=path/to/your/notes/
   ```

## Использование

### Первый запуск

1. **Подготовьте заметки:**
   - Поместите ваши Markdown файлы в директорию, указанную в `NOTES_DIR`
   - Система автоматически создаст директорию, если она не существует

2. **Запустите систему:**
   ```bash
   python main.py
   ```

3. **При первом запуске:**
   - Система загрузит все `.md` файлы из указанной директории
   - Создаст векторный индекс (это может занять некоторое время)
   - Сохранит индекс в папке `faiss_index/` для последующих запусков

### Работа с системой

После запуска вы можете задавать вопросы в интерактивном режиме:

```
Введите ваш запрос: Что такое машинное обучение?
```

Система:
1. Найдет релевантные фрагменты в ваших заметках
2. Отправит их вместе с вопросом в Mistral AI
3. Получит и отобразит ответ

## Конфигурация

### Доступные модели Mistral AI

- `mistral-tiny` - быстрая, экономичная модель
- `mistral-small` - сбалансированная модель
- `mistral-medium` - более мощная модель
- `mistral-large-latest` - самая мощная модель (по умолчанию)

### Настройки индексации

Система использует следующие параметры по умолчанию:
- **Размер чанка:** 600 слов
- **Перекрытие:** 80 слов
- **Модель эмбеддингов:** `sentence-transformers/all-MiniLM-L6-v2`
- **Количество результатов поиска:** 4

## Структура проекта

```
simple_rag_system/
├── main.py              # Основной файл с логикой RAG системы
├── prompt_manager.py     # Управление промптами и парсинг ответов LLM
├── config.py            # Конфигурация и настройки
├── base_types.py        # Базовые типы данных
├── enums.py             # Перечисления (модели)
├── req.txt              # Зависимости Python
├── example.env          # Пример файла окружения
├── faiss_index/         # Директория с индексом (создается автоматически)
│   ├── index.faiss      # FAISS индекс
│   └── documents.pkl    # Сериализованные документы
└── README.md            # Документация
```

## Архитектура

### Основные компоненты

1. **RAGEngine** - основной движок системы
   - Загружает и обрабатывает Markdown файлы
   - Создает и управляет векторным индексом
   - Выполняет поиск релевантных фрагментов

2. **MistralClient** - клиент для работы с Mistral AI
   - Отправляет запросы к API
   - Обрабатывает ошибки и повторные попытки

3. **PromptManager** - управление промптами и ответами
   - Создает структурированные промпты для LLM
   - Парсит ответы и определяет необходимость создания заметок
   - Разделяет найденную информацию и дополнительную информацию от AI

4. **NoteManager** - управление заметками
   - Автоматически создает новые заметки на основе ответов LLM
   - Сохраняет заметки в подпапке `rag_new/`
   - Проверяет дублирование по именам файлов

5. **Система индексации**
   - Разбивает текст на чанки с перекрытием
   - Создает векторные представления с помощью SentenceTransformers
   - Сохраняет индекс в FAISS для быстрого поиска

### Процесс работы

1. **Инициализация:** Загрузка документов и создание/загрузка индекса
2. **Поиск:** Векторный поиск релевантных фрагментов по запросу
3. **Создание промпта:** PromptManager формирует структурированный промпт с контекстом
4. **Генерация:** Отправка промпта в Mistral AI
5. **Парсинг ответа:** Анализ ответа и определение необходимости создания заметки
6. **Создание заметки:** При необходимости NoteManager создает новую заметку
7. **Ответ:** Отображение результата пользователю

## Ограничения

- Поддерживаются только файлы в формате Markdown (`.md`)
- Требуется API ключ Mistral AI
- Первая индексация может занять время при большом количестве документов
- Система работает только с текстовым контентом
- Автоматически созданные заметки сохраняются в подпапке `rag_new/`
- Система создает заметки только при наличии дополнительной информации от LLM

## Устранение неполадок

### Частые проблемы

1. **Ошибка API токена:**
   - Проверьте правильность токена в файле `.env`
   - Убедитесь, что у вас есть активная подписка Mistral AI

2. **Проблемы с индексацией:**
   - Убедитесь, что в директории `NOTES_DIR` есть файлы `.md`
   - Проверьте права доступа к файлам

3. **Медленная работа:**
   - При первом запуске система создает индекс - это нормально
   - Последующие запуски будут быстрее благодаря кэшированию

## Лицензия

Проект распространяется под лицензией, указанной в файле `LICENSE`.

## Версия

**v0.1.0** - Версия с улучшенным управлением промптами и автоматическим созданием заметок.

---

*Для получения поддержки или сообщения об ошибках создайте issue в репозитории проекта.*
