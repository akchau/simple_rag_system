import subprocess
import time

# Список вопросов, покрывающий все сгенерированные темы
questions = [
    # --- LINUX ---
    "Какая команда используется для просмотра содержимого каталога?",
    "Как сменить права доступа к файлу?",
    "Для чего используется команда grep?",
    "Как называется суперпользователь в Linux?",
    "В каком файле хранится список пользователей?",

    # --- PYTHON ---
    "Зачем нужны отступы в Python?",
    "Какой командой создать виртуальное окружение?",
    "Для чего нужна библиотека pandas?",
    "Какое ключевое слово используется для объявления функций?",
    "Чем отличаются списки от словарей?",

    # --- КОСМОС ---
    "Почему Марс называют Красной планетой?",
    "Какая планета самая большая в Солнечной системе?",
    "Чему равна скорость света?",
    "Что такое черная дыра?",
    "Кто и когда полетел в космос первым?",

    # --- БЕЗОПАСНОСТЬ ---
    "Что позволяет сделать SQL-инъекция?",
    "Что такое XSS атака?",
    "Что такое фишинг?",
    "В чем суть принципа наименьших привилегий?",
    "Зачем нужен VPN?"
]

def run_test():
    print(f"[*] Запуск автоматического теста ({len(questions)} вопросов)...")
    print("[*] Пожалуйста, подождите, это займет около 10-20 секунд.\n")

    # Объединяем вопросы в один поток текста
    input_text = "\n".join(questions) + "\n"

    try:
        # Запускаем main.py как отдельный процесс
        process = subprocess.Popen(
            ['python', 'main.py'],
            stdin=subprocess.PIPE,
            stdout=subprocess.PIPE,
            stderr=subprocess.PIPE,
            text=True,
            encoding='utf-8',
            errors='ignore'
        )

        # Отправляем вопросы и получаем ответы
        # (communicate ждет завершения процесса или закрытия потоков)
        stdout, stderr = process.communicate(input=input_text)

        print("=== НАЧАЛО ОТЧЕТА ===")
        print(stdout)
        print("=== КОНЕЦ ОТЧЕТА ===")

        if stderr:
            print("\n[!] Были ошибки в потоке stderr (это нормально, если это предупреждения библиотек):")
            print(stderr)

    except Exception as e:
        print(f"Произошла ошибка при запуске теста: {e}")

if __name__ == "__main__":
    run_test()
